<div class="cbi-section">
	<h3><%:Dependency Helper%></h3>
	<p>
		<%:Install or remove nftables / TTL spoof related kmods and utilities with a single click.%>
	</p>
	<div class="cbi-section-node">
		<button type="button" class="btn cbi-button cbi-button-apply" onclick="depctlRun('install')">
			<%:Install required packages%>
		</button>
		<button type="button" class="btn cbi-button cbi-button-reset" onclick="depctlRun('remove')">
			<%:Remove installed packages%>
		</button>
	</div>
	<pre id="depctl-output" class="cbi-section-node" style="min-height: 140px; margin-top: 8px; overflow:auto;"></pre>
</div>

<script type="text/javascript">
	function depctlRun(action) {
		var output = document.getElementById('depctl-output');
		output.textContent = '<%:Running...%>';
		var endpoint = (action === 'install') ? 'install_deps' : 'remove_deps';

		XHR.get(L.url('admin/network/ttl-hotspor-changer/action/' + endpoint), null, function (x, data) {
			if (!data) {
				output.textContent = '<%:No response from helper.%>';
				return;
			}

			var text = data.output || '';
			text += '\nexit code: ' + data.code;
			output.textContent = text.trim();
		});
	}
</script>
