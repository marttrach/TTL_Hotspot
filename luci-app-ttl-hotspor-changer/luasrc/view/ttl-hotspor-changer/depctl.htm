<style>
	.ttl-depctl {
		border-radius: 14px;
		padding: 22px;
		margin-bottom: 18px;
		background: var(--main-bg-color, #0f111a);
		border: 1px solid rgba(255, 255, 255, 0.08);
		box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
		color: #e6edf3;
	}
	.ttl-depctl h3 {
		margin: 0 0 8px 0;
		font-size: 22px;
	}
	.ttl-depctl p {
		margin: 0 0 18px 0;
		color: rgba(230, 237, 243, 0.8);
	}
	.ttl-depctl .ttl-btn-row {
		display: flex;
		gap: 12px;
		flex-wrap: wrap;
	}
	.ttl-btn {
		flex: 1 1 240px;
		padding: 16px;
		border-radius: 12px;
		font-size: 16px;
		font-weight: 600;
		border: 1px solid transparent;
		cursor: pointer;
		transition: transform 0.15s ease, box-shadow 0.15s ease;
	}
	.ttl-btn.install {
		background: linear-gradient(145deg, #1f6feb, #1158c7);
		border-color: #1f6feb;
		color: #fff;
	}
	.ttl-btn.remove {
		background: linear-gradient(145deg, #f85149, #c93c3c);
		border-color: #f85149;
		color: #fff;
	}
	.ttl-btn:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
	}
	.ttl-output {
		margin-top: 18px;
		min-height: 160px;
		border-radius: 12px;
		padding: 16px;
		background: rgba(0, 0, 0, 0.45);
		border: 1px solid rgba(255, 255, 255, 0.06);
		color: #e6edf3;
		font-family: "SFMono-Regular", Consolas, "Liberation Mono", monospace;
		white-space: pre-wrap;
	}
</style>

<div class="ttl-depctl">
	<h3><%:Dependency Helper%></h3>
	<p><%:Install or remove nftables / TTL spoof related kmods and utilities with a single click.%></p>
	<div class="ttl-btn-row">
		<button type="button" class="ttl-btn install" onclick="depctlRun('install')">
			<%:Install required packages%>
		</button>
		<button type="button" class="ttl-btn remove" onclick="depctlRun('remove')">
			<%:Remove installed packages%>
		</button>
	</div>
	<pre id="depctl-output" class="ttl-output"></pre>
</div>

<script type="text/javascript">
	function depctlRun(action) {
		var output = document.getElementById('depctl-output');
		output.textContent = '<%:Running...%>';
		var endpoint = (action === 'install') ? 'install_deps' : 'remove_deps';

		XHR.get(L.url('admin/network/ttl-hotspor-changer/action/' + endpoint), null, function (x, data) {
			if (!data) {
				output.textContent = '<%:No response from helper.%>';
				return;
			}

			var text = data.output || '';
			text += '\nexit code: ' + data.code;
			output.textContent = text.trim();
		});
	}
</script>
